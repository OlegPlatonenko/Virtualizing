# Certified Kubernetes Administrator

```bash
#Prerequisits on Master
sudo apt-get update
sudo apt-get upgrade

sudo docker pull k8s.gcr.io/kube-scheduler-amd64:v1.10.1
sudo docker pull k8s.gcr.io/etcd-amd64:3.1.12
sudo docker pull  k8s.gcr.io/kube-apiserver-amd64:v1.10.1
sudo docker pull k8s.gcr.io/kube-controller-manager-amd64:v1.10.1

sudo kubeadm init --pod-network-cidr=10.244.0.0/16

kubeadm join --token --discovery-token-ca-cert-hash sha256:

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config 
sudo chown $(id -u):$(id -g) $HOME/.kube/config

kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

kubectl get pods --all-namespaces
kubtctl get nodes
```

## API Primitives

- Persistent entries in the k8s system
- Uses these to represent state of the cluster
- Describe:
    1. What applications are running
    2. Which nodes those apps are running on
    3. Policies around those apps
- Kubernetes objects are "recors of intent"

-------------------------------------------------------
- Object spec
- Object status

## Common K8S Objects

- **Nodes** - hosts which make up cluster
- **Pods** - single instances of app containers
- **Deployments** - load balanced sets of pods
- **Services** - expose deployments to external networks
- **ConfigMaps** - key walue pairs

## Names and UIDs

Names:
- All objects have a unique name
- Client provided
- Can be reused
- Max length 253 char.
- Lower case alphanumeric charact.
- and . allowed

UIDs
- All objects have a unique UID
- Generated by k8s
- Spatially and temporally unique

## Namespaces

- Multiple virtual clusters back by the same physical cluster
- Generally for large deployments
- provide scope of names
- Easy way to divide cluster resources
- Allows for multiple teams of users
- Aloows for resource quotas
- Special "kube-system" namespace

## Nodes

- VM or physical machine
- Services necessary to run pods
- Managed by the master
- Services necessary:
    1. **Container runtime** - like Docker
    2. **Kubelet** - orchestrates the containers in local node
    3. **Kube-proxy** - handles networking
- Not inherently created by k8s, but by Cloud Provider
- Kubernetes checks the node for validity

## Cloud Controller Managers

- Route controller
- Service Controller
- PersistentVolumeLabels controller

## Node Controller

- Assign CIDR block to a newly registered node
- Keeps track of the nodes
- Monitors the node health
- Evicts pods from unhealthy nodes
- Can taint nodes based on current conditions in more recent versions

## Kubernetes Services and Network Primitives

- Underlying Architecture
- Pod -- Simplest Cubernetes object
- Ephemereal
- Usually Managed via Deployments

----------------------------------------

Kubernetes services:
- Deployment specification
- Image
- Number of replicas

- Services --> Deployments
- Particular port or IP address

## Designing a Kubernetes Cluster

- Minikube
- Kubeadm

## Node health and status

```bash
#Get cluster overview
kubectl get nodes

#Get pods running on paticular node
kubectl describe node <node-name>
kubectl get pods --all-namespaces -o wide

#CPU, memory, disk info
kubectl describe node <node-name>

#Get pods running in aprticular namespace
kubectl get pods -n <namespace-name>
```

## Securing Cluster Communication

- default encryption communication in k8s is TLS
- k8s has an integrated Role-Based Acess Control (RBAC)

- Secure etcd (database) is very important!

## Make Kubernetes Highly Available

- Reliable nodes that will form a cluster
- Set a redundant and reliable storage with multinode etcd
- Replicated and load balanced k8s API servers
- Master-elected k8s scheduler and controller manager daemons